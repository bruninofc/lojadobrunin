  <!-- ================= AVALIAÇÕES - INÍCIO ================= -->
<style>
  .rating-card{background:#0f0f0f;padding:16px;border-radius:12px;margin:12px 0;color:#fff;box-shadow:0 0 30px rgba(255,0,150,0.12);}
  .rating-stars{font-size:22px;color:#ffd700;margin-bottom:6px;}
  .rating-count{color:#cfcfcf;margin-bottom:6px;}
  .rating-submit{display:flex;gap:8px;align-items:center;margin-top:8px;}
  .rating-submit select, .rating-submit input[type="text"], .rating-submit textarea{padding:8px;border-radius:8px;border:0;background:#222;color:#fff;min-width:120px}
  .rating-submit button{background:#2bd36b;border:0;padding:10px 14px;border-radius:10px;color:#063;cursor:pointer}
  .review-list{margin-top:12px}
  .single-review{background:#111;padding:10px;border-radius:8px;margin-bottom:8px;color:#ddd}
  .review-meta{font-size:12px;color:#999;margin-bottom:6px}
  .demo-badge{background:linear-gradient(90deg,#ff7aa6,#9b7bff);color:#fff;padding:2px 6px;border-radius:6px;font-size:11px;margin-left:8px}
</style>

<div class="rating-card" id="rating-for-prod-LOJADOBRUXIN" data-product-id="lojadobrunin">
  <div>
    <div class="rating-stars" id="avg-stars">★★★★★</div>
    <div class="rating-count" id="avg-count">Avaliações: 0 • Média: 0.0</div>
  </div>

  <div class="rating-submit">
    <select id="rating-score">
      <option value="5">⭐️⭐️⭐️⭐️⭐️ 5</option>
      <option value="4">⭐️⭐️⭐️⭐️ 4</option>
      <option value="3">⭐️⭐️⭐️ 3</option>
      <option value="2">⭐️⭐️ 2</option>
      <option value="1">⭐️ 1</option>
    </select>

    <input id="rating-name" type="text" placeholder="Seu nome (opcional)" />
    <button id="rating-send">Enviar avaliação</button>
  </div>

  <div class="review-list" id="reviews-list"></div>
</div>

<script>
  // UTIL: salva avaliações por productId no localStorage
  function storageKey(productId){ return 'reviews_'+productId; }

  function getReviews(productId){
    try {
      const raw = localStorage.getItem(storageKey(productId));
      return raw ? JSON.parse(raw) : [];
    } catch(e){ return []; }
  }

  function saveReviews(productId, arr){
    localStorage.setItem(storageKey(productId), JSON.stringify(arr));
  }

  function formatStars(avg){
    // retorna string com estrelas preenchidas (unicode) - máximo 5
    const full = Math.round(avg);
    let s = '';
    for(let i=0;i<5;i++) s += (i<full ? '★' : '☆');
    return s;
  }

  function renderRating(productId){
    const reviews = getReviews(productId);
    const count = reviews.length;
    const avg = count ? (reviews.reduce((a,b)=>a+b.rating,0)/count) : 0;
    document.getElementById('avg-count').innerText = `Avaliações: ${count} • Média: ${avg.toFixed(1)}`;
    document.getElementById('avg-stars').innerText = formatStars(avg);
    // render reviews
    const list = document.getElementById('reviews-list');
    list.innerHTML = '';
    // mostrar do mais recente
    reviews.slice().reverse().forEach(r => {
      const div = document.createElement('div');
      div.className = 'single-review';
      const meta = document.createElement('div');
      meta.className = 'review-meta';
      meta.innerHTML = `<strong>${escapeHtml(r.name||'Anônimo')}</strong> • ${r.rating} estrelas ${r.demo ? '<span class="demo-badge">demo</span>' : ''} • ${new Date(r.ts).toLocaleString()}`;
      const text = document.createElement('div');
      text.innerText = r.text || '';
      div.appendChild(meta);
      if(r.text) div.appendChild(text);
      list.appendChild(div);
    });
  }

  // função para escapar HTML simples (evita injeção)
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

  // adicionar avaliação
  function addReview(productId, rating, name, text, demo=false){
    const arr = getReviews(productId);
    arr.push({rating: Number(rating), name: String(name||''), text: String(text||''), ts: Date.now(), demo: !!demo});
    saveReviews(productId, arr);
    renderRating(productId);
  }

  // seed demo — CRIAR SÓ PARA TESTE E MARCAR COMO 'demo'
  function seedDemoReviews(productId, n){
    const names = ['Luana','Breno','Victor','Ana','DemoUser'];
    for(let i=0;i<n;i++){
      const rating = Math.floor(Math.random()*2)+4; // 4 ou 5
      const name = names[i % names.length] + (i>10?i:'');
      addReview(productId, rating, name, 'Avaliação de demonstração', true);
    }
  }

  // inicialização para o seu produto
  (function(){
    const container = document.getElementById('rating-for-prod-LOJADOBRUXIN');
    if(!container) return;
    const productId = container.dataset.productId || 'prod-default';
    renderRating(productId);

    // vincular botão enviar
    document.getElementById('rating-send').addEventListener('click', ()=>{
      const score = document.getElementById('rating-score').value;
      const name = document.getElementById('rating-name').value;
      // opcional: prompt para comentário
      const comment = prompt('Quer deixar um comentário? (opcional)') || '';
      addReview(productId, score, name, comment, false);
      alert('Obrigado! Sua avaliação foi salva localmente (apenas neste dispositivo).');
    });

    // se quiser gerar demo para ver como fica (descomente abaixo)
    // seedDemoReviews(productId, 50);
  })();
</script>
<!-- ================= AVALIAÇÕES - FIM ================= -->
